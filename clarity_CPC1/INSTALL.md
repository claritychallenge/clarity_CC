# CLARITY CPC1 - INSTALLATION + USAGE

The following instructions explain how to install and use the CPC1 software.

The software has been tested on Mac OS and Linux systems, but if you experience any problems please [contact us](http://claritychallenge.org/sign-up-to-the-challenges) or post a query to the challenge [Google group](https://groups.google.com/g/clarity-challenge?pli=1).

## 0. Prerequisites

You will need,

- Python (3.7 or more recent)
- ~20 GB of disk space for the challenge data

Visit the `install/` directory. 

## 1. Installation

Visit the `install/` directory and run the `install.sh` script.

```bash
cd install
./install.sh
```

This script will:

- Set up a Python virtual environment and install required Python packages.

The code supplied will produce baseline predictions using the MSBG hearing loss model and MBSTOI intelligibility metric that were released as part of the Clarity Enhancement Challenge.


## 2. Install the challenge data

The challenge data is a 60 GB download and provides the material necessary to build the 6,000 scene official training set and 2,500 scene official development set.

First, visit the [download site](https://mab.to/R6H84YNf74p5U) and download the following data packs

- `clarity_CPC1_data.v1.tgz`  [17 GB]

To download: click on the file to select it and then click on the download icon in the top-right of the interface. Select 'As individual files'. (The site also lists datapacks for 'premixed' scenes. You do no need to download these as they will be generated by the software.)

Unpack the data into a root directory of your choosing using

```bash
cd install
./unpack.sh <DOWNLOAD_DIR>/clarity_CEC1_data.main.v1_0.tgz <TARGET_DIR>
```

where `DOWNLOAD_DIR` is the location of the download and `<TARGET_DIR>` is the desired location of the unpacked data. The script will produce a directory `<TARGET_DIR>/clarity_CEC1_data` containing the data.

IMPORTANT: Do not untar the package by hand. The `unpack.sh` script does more than just untarring, in addition it i) adds a couple of important symbolic links between this installation directory and the downloaded data ii) patches a broken metadatafile in v1 of the download. If you are unsure please check the script.


## 3. Check the integrity of the data

A simple script is available that will check that the data is correctly installed.
It can be run using,

```
python3 scripts/check_data.py
```

## 4. Generate predicted intelligibility scores

A reference objective intelligibility measure is being provided. This measure is based on a combination of a hearing loss model and the MBSTOI intelligibility score. It will be used to select systems to present to the listening panel in the event that there are too many entrants for all to be assessed via listening tests (see Challenge rules).

To evaluate the output of the reference hearing aid use,

```bash
./predict.sh dev
```

Note, the `predict.sh` will take a long time to run completely. For each scene, intelligibility predictions for three different listeners are generated. The script can be safely stopped at any stage and outputs for scenes processed so far will appear appended to a file called `sii.txt` in `<CLARITY_ROOT>/data/clarity_data/train/scenes` or `<CLARITY_ROOT>/data/clarity_data/dev/scenes`.

There is a script `run_all.sh` that runs all of the above steps.

